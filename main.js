(()=>{"use strict";var e={formSelector:"",inputSelector:"",submitButtonSelector:"",inputErrorClass:""},t=function(t,r,n){var o=t.querySelector(".".concat(r.id,"-error"));r.classList.add(e.inputErrorClass),o.textContent=n},r=function(t,r){var n=t.querySelector(".".concat(r.id,"-error"));r.classList.remove(e.inputErrorClass),n.textContent=""},n=function(e,t){!function(e){return!Array.from(e).some((function(e){return!e.validity.valid}))}(e)?t.disabled=!0:t.disabled=!1},o=function(t){var o=t.querySelector(e.formSelector),c=o.querySelectorAll(e.inputSelector),a=o.querySelector(e.submitButtonSelector);c.forEach((function(e){return r(o,e)})),n(c,a)},c=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");a(t)}},a=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",c)},u=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",c)},i=function(e){var t=e.textContent;return e.textContent="Сохранение...",e.disabled=!0,function(){e.textContent=t,e.disabled=!1}},l={baseUrl:"https://nomoreparties.co/v1/plus-cohort-15",headers:{authorization:"99c8957e-2f0c-4280-8057-91a4e8729164","Content-Type":"application/json"}},s=function(e){return console.log(e)},d=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},p=document.querySelector(".cards__grid"),f=document.querySelector("#card").content,y=document.querySelector(".popup_type_image"),_=y.querySelector(".popup__image"),h=y.querySelector(".popup__caption"),v=function(e,t){var r=e.name,n=e.link,o=e.likes,c=e.owner,a=e._id,i=f.querySelector(".card").cloneNode(!0),p=i.querySelector(".card__box");p.querySelector(".card__title").textContent=r;var v=i.querySelector(".card__photo");if(v.src=n,v.alt=r,v.addEventListener("click",(function(e){_.src=n,_.alt=r,h.textContent=r,u(y)})),function(e,t,r,n){var o=e.querySelector(".card__button_type_like"),c=e.querySelector(".card__like-counter");c.textContent=t.length,t.some((function(e){return e._id===n}))&&o.classList.add("card__button_like-active"),o.addEventListener("click",(function(e){var t;o.classList.contains("card__button_like-active")?(t=r,fetch("".concat(l.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:l.headers})).then(d).then((function(e){c.textContent=e.likes.length,o.classList.remove("card__button_like-active")})).catch(s):function(e){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:l.headers})}(r).then(d).then((function(e){c.textContent=e.likes.length,o.classList.add("card__button_like-active")})).catch(s)}))}(p,o,a,t),c._id===t){var m=i.querySelector(".card__button_type_delete");m.style.display="block",m.addEventListener("click",(function(){var e;(e=a,fetch("".concat(l.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:l.headers})).then((function(e){return e.ok?i.remove():Promise.reject("Ошибка: ".concat(e.status))})).catch(s)}))}return i},m=function(e,t){p.prepend(v(e,t))},b={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"popup__input_incorrect"};function S(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function q(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var E={},k=document.querySelector(".profile"),g=k.querySelector(".profile__name"),L=k.querySelector(".profile__profession"),C=k.querySelector(".profile__avatar"),O=k.querySelector(".profile__button_type_edit"),j=k.querySelector(".profile__button_type_add"),x=document.querySelectorAll(".popup"),P=document.querySelector(".popup_type_profile"),w=P.querySelector(".popup__form"),U=w.querySelector("#job-input"),A=w.querySelector("#username-input"),D=w.querySelector(b.submitButtonSelector),B=document.querySelector(".popup_type_add-card"),T=B.querySelector(".popup__form"),M=T.querySelector("#place-input"),N=T.querySelector("#href-input"),J=B.querySelector(b.submitButtonSelector),H=document.querySelector(".popup_type_avatar"),I=H.querySelector(".popup__form"),z=I.querySelector("#avatar-input"),F=H.querySelector(b.submitButtonSelector),G=function(){A.value=g.textContent,U.value=L.textContent};G(),function(o){!function(t){for(var r=0,n=Object.keys(e);r<n.length;r++){var o=n[r];e[o]=t[o]}}(o),document.querySelectorAll(e.formSelector).forEach((function(o){!function(o){var c=o.querySelectorAll(e.inputSelector),a=o.querySelector(e.submitButtonSelector);c.forEach((function(u){u.addEventListener("input",(function(){!function(e,n){n.validity.valid?r(e,n):n.validity.patternMismatch?t(e,n,n.dataset.errorMessage):n.validity.valueMissing?t(e,n,"Вы пропустили это поле."):t(e,n,n.validationMessage)}(o,u,e.inputErrorClass),n(c,a)}))}))}(o)}))}(b),fetch("".concat(l.baseUrl,"/users/me"),{headers:l.headers}).then(d).then((function(e){E=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(Object(r),!0).forEach((function(t){q(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e),g.textContent=E.name,L.textContent=E.about,C.style.backgroundImage="url(".concat(E.avatar,")")})).catch(s).then((function(){return fetch("".concat(l.baseUrl,"/cards"),{headers:l.headers}).then(d).then((function(e){return e.sort((function(e,t){return e.createdAt>t.createdAt?1:-1})).forEach((function(e){return m(e,E._id)}))})).catch(s)})).catch(s),w.addEventListener("submit",(function(e){e.preventDefault();var t,r,n=i(D);(t=A.value,r=U.value,fetch("".concat(l.baseUrl,"/users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify({name:t,about:r})})).then(d).then((function(e){g.textContent=e.name,L.textContent=e.about,n(),a(P)})).catch(s)})),T.addEventListener("submit",(function(e){e.preventDefault();var t,r,n=i(J);(t=M.value,r=N.value,fetch("".concat(l.baseUrl,"/cards"),{method:"POST",headers:l.headers,body:JSON.stringify({name:t,link:r})})).then(d).then((function(e){m(e,E._id),T.reset(),n(),a(B)}))})),H.addEventListener("submit",(function(e){e.preventDefault();var t,r=i(F);(t=z.value,fetch("".concat(l.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:t})})).then(d).then((function(e){C.style.backgroundImage="url(".concat(e.avatar,")"),I.reset(),r(),a(H)})).catch(s)})),O.addEventListener("click",(function(){G(),o(P),u(P)})),j.addEventListener("click",(function(){T.reset(),o(B),u(B)})),C.addEventListener("click",(function(){I.reset(),o(H),u(H)})),x.forEach((function(e){e.addEventListener("click",(function(t){(t.target.classList.contains("popup")||t.target.classList.contains("popup__close-button"))&&a(e)}))}))})();